<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      lang="en">

<head>
    <meta charset="UTF-8">
    <title>Quiz IT</title>
    <style>
        * {margin-left: auto;
            margin-right: auto;
            text-align: center;
            padding: 3px;}
        nav {background-color: #fafafa;
            border:1px solid #aaa;
            padding: 15px;}
        ul {list-style: none;
            text-align: center;}
        li {display: inline-block;
            margin-right: 20px;}
        li a {color: #000;}
    </style>
</head>

<body>
<nav>
    <ul>
        <li><a href="/">Quizzes</a></li>
        <li><a href="/add">Add</a></li>
        <li><a href="/login">Log In</a></li>
        <li><a href="/register">Register</a></li>
        <button id="logout-button">Log Out</button>

    </ul>
</nav>

<h1>This is a QUIZ IT website.</h1>
<form id="search-form">
    <input id="title-input" type="text" name="search-title" placeholder="Title" />
    <button type="submit">Search!</button>
</form>

<select id="category-select">
<option value="" disabled selected>---</option>
</select>

<div id="quiz-list-div">
    Quizzes:
    <ul id="quiz-list">

    </ul>
</div>
</body>

<script>

    const logOutButton = document.getElementById("logout-button");
    logOutButton.addEventListener('click', () => localStorage.removeItem('user'));

    const populateCategories = () => {
        fetch("http://quizit-europe.herokuapp.com/api/categories")
            .then(res => res.json())
            .then(res => res.forEach((category => {
                const categorySelectOption = document.createElement('option');
                categorySelectOption.setAttribute('value', category.id);
                categorySelectOption.setAttribute('name', category.name);
                categorySelectOption.innerText = category.name;
                categorySelect.appendChild(categorySelectOption);
            })));
    }

    const populateQuizzes = (title, categoryId) => {
        const quizListUl = document.querySelector("#quiz-list");
        quizListUl.innerHTML= '';

        if(!title && !categoryId){
            fetch("http://quizit-europe.herokuapp.com/api/quizzes")
                .then(res => res.json())
                .then(res => res.forEach((quiz => {
                    const quizListLi = document.createElement('li');
                    quizListLi.innerHTML = "<a href='/quizzes/" + quiz.id + "' />" + quiz.title + "</a>";
                    quizListUl.appendChild(quizListLi);
                })));
        } else if (title) {
            fetch("http://quizit-europe.herokuapp.com/api/quizzes/title/"+title)
                .then(res => res.json())
                .then(res => res.forEach((quiz => {
                    const quizListLi = document.createElement('li');
                    quizListLi.innerHTML = "<a href='/quizzes/" + quiz.id + "' />" + quiz.title + "</a>";
                    quizListUl.appendChild(quizListLi);
                })));
        } else if (categoryId) {
            fetch("http://quizit-europe.herokuapp.com/api/quizzes/category/"+categoryId)
                .then(res => res.json())
                .then(res => res.forEach((quiz => {
                    const quizListLi = document.createElement('li');
                    quizListLi.innerHTML = "<a href='/quizzes/" + quiz.id + "' />" + quiz.title + "</a>";
                    quizListUl.appendChild(quizListLi);
                })));
        }
    }
    const search = e => {
        e.preventDefault();
        const searchInput = document.querySelector("#search-form input");
        populateQuizzes(searchInput.value);
    }

    const handleSelectChange = e => {
        e.preventDefault();
        populateQuizzes(null, categorySelect.value)
    }

    const searchForm = document.querySelector("#search-form");
    searchForm.addEventListener('submit', search);

    const categorySelect = document.querySelector("#category-select");
    categorySelect.addEventListener('change', handleSelectChange);

    populateCategories();
    populateQuizzes();

</script>
</html>